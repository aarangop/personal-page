import{p as A,i as E,a as g}from"./entry.DSAJl3_J.js";function v(e){const i=JSON.parse(e);return i.data&&(i.data=A(i.data)),i}function c(e){return HTMLElement.prototype.cloneNode.call(e)}function F(e,i=()=>{}){if(c(e).method!=="post")throw new Error('use:enhance can only be used on <form> fields with method="POST"');const l=async({action:a,result:s,reset:n=!0,invalidateAll:r=!0})=>{s.type==="success"&&(n&&HTMLFormElement.prototype.reset.call(e),r&&await E()),(location.origin+location.pathname===a.origin+a.pathname||s.type==="redirect"||s.type==="error")&&g(s)};async function u(a){var p,b,h,y;if(((p=a.submitter)!=null&&p.hasAttribute("formmethod")?a.submitter.formMethod:c(e).method)!=="post")return;a.preventDefault();const n=new URL((b=a.submitter)!=null&&b.hasAttribute("formaction")?a.submitter.formAction:c(e).action),r=new FormData(e);if(c(e).enctype!=="multipart/form-data"){for(const t of r.values())if(t instanceof File)throw new Error('Your form contains <input type="file"> fields, but is missing the necessary `enctype="multipart/form-data"` attribute. This will lead to inconsistent behavior between enhanced and native forms. For more details, see https://github.com/sveltejs/kit/issues/9819.')}const d=(h=a.submitter)==null?void 0:h.getAttribute("name");d&&r.append(d,((y=a.submitter)==null?void 0:y.getAttribute("value"))??"");const m=new AbortController;let f=!1;const w=await i({action:n,cancel:()=>f=!0,controller:m,formData:r,formElement:e,submitter:a.submitter})??l;if(f)return;let o;try{const t=await fetch(n,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:r,signal:m.signal});o=v(await t.text()),o.type==="error"&&(o.status=t.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;o={type:"error",error:t}}w({action:n,formData:r,formElement:e,update:t=>l({action:n,result:o,reset:t==null?void 0:t.reset,invalidateAll:t==null?void 0:t.invalidateAll}),result:o})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",u),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",u)}}}export{F as e};
